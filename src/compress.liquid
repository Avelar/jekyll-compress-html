{% comment %}
             Input
{% endcomment %}

{% assign _content = content %}


{% comment %}
             Remove end tags
{% endcomment %}

{% for _element in site.compress_html.endings %}
  {% assign _end = _element | prepend: "</" | append: ">" %}
  {% assign _content = _content | remove: _end %}
{% endfor %}


{% comment %}
             Remove comments
{% endcomment %}

{% if site.compress_html.comments.size == 2 %}
  {% assign _new = "" %}
  {% assign _comment_befores = _content | split: site.compress_html.comments.first %}
  {% for _comment_before in _comment_befores %}
    {% assign _comment_after = _comment_before | split: site.compress_html.comments.last | last %}
    {% assign _new = _new | append: _comment_after %}
  {% endfor %}
  {% assign _content = _new %}
{% endif %}


{% comment %}
             Compress whitespace outside of <pre>
{% endcomment %}

{% assign _new = "" %}
{% assign _pre_befores = _content | split: "<pre" %}
{% for _pre_before in _pre_befores %}
  {% assign _pres = _pre_before | split: "</pre>" %}
  {% if _pres.size == 2 %}
    {% assign _new = _new | append: "<pre" | append: _pres.first | append: "</pre>" %}
  {% endif %}
  {% assign _compressed = _pres.last | split: " " | join: " " %}
  {% assign _new = _new | append: _compressed %}
{% endfor %}
{% assign _content = _new %}


{% comment %}
             Clip whitespace around elements
{% endcomment %}

{% for _element in site.compress_html.clippings %}
  {% assign _edges = " <e,<e; </e>,</e>;</e> ,</e>" | replace: "e", _element | split: ";" %}
  {% for _edge in _edges %}
    {% assign _replacement = _edge | split: "," %}
    {% assign _content = _content | replace: _replacement.first, _replacement.last %}
  {% endfor %}
{% endfor %}


{% comment %}
             Output
{% endcomment %}

{{ _content }}
