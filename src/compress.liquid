{% assign _content = content %}

{% for _element in site.compress_html.endings %}
  {% assign _end = "</element>" | replace: "element", _element %}
  {% assign _content = _content | remove: _end %}
{% endfor %}

{% if site.compress_html.comments.size == 2 %}
  {% assign _new = "" %}
  {% assign _comment_befores = _content | split: site.compress_html.comments.first %}
  {% for _comment_before in _comment_befores %}
    {% assign _comment_after = _comment_before | split: site.compress_html.comments.last | last %}
    {% assign _new = _new | append: _comment_after %}
  {% endfor %}
  {% assign _content = _new %}
{% endif %}

{% assign _pres = _content | split: "<pre" %}

{% for _pre1 in _pres %}

  {% assign _pre2 = _pre1 | split: "</pre>" %}
  {% if _pre2.size == 2 %}<pre{{ _pre2.first }}</pre>{% endif %}
  {% assign _second = _pre2.last %}

  {% assign _second = _second | split: " " | join: " " %}

  {% for _element in site.compress_html.clippings %}
    {% assign _edges = " <element,<element; </element>,</element>;</element> ,</element>" | replace: "element", _element | split: ";" %}

    {% for _edge in _edges %}
      {% assign _replacement = _edge | split: "," %}
      {% assign _second = _second | replace: _replacement[0], _replacement[1] %}
    {% endfor %}
  {% endfor %}

  {{ _second }}

{% endfor %}
